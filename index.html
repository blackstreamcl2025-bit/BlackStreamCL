<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BlackStreamCL Forum — Réplica (Demo)</title>
  <style>
    /* Palette inspired by dark/forum style */
    :root{
      --bg:#0b0d10;
      --panel:#0f1317;
      --muted:#9aa4b2;
      --accent:#00b4ff;
      --accent-2:#7c3aed;
      --card:#0e1114;
      --glass: rgba(255,255,255,0.035);
      --success:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6eef8;background:linear-gradient(180deg,#071018 0%, #0b0d10 100%);}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:26px auto;padding:18px;display:grid;gap:18px}
    header{display:flex;align-items:center;gap:16px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .logo {display:flex;align-items:center;gap:12px}
    .logo .mark{width:44px;height:44px;border-radius:8px;display:grid;place-items:center;font-weight:800;background:linear-gradient(135deg,var(--accent-2),var(--accent));color:#061018}
    .logo h1{margin:0;font-size:18px;letter-spacing:0.2px}
    .logo p{margin:0;font-size:12px;color:var(--muted)}
    nav{margin-left:auto;display:flex;gap:8px}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:#e6eef8;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:0;color:#021224}
    .layout{display:grid;grid-template-columns:260px 1fr;gap:18px}
    /* Sidebar */
    aside.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;padding:14px}
    .cat-list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .cat{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;color:var(--muted);cursor:pointer}
    .cat:hover{background:var(--glass)}
    .search input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    /* Main */
    main .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:14px;border-radius:12px}
    .controls{display:flex;align-items:center;gap:12px}
    .threads{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .thread{display:flex;gap:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);align-items:center;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
    .thread:hover{transform:translateY(-2px);transition:transform .12s}
    .avatar{width:56px;height:56px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:grid;place-items:center;font-weight:800;color:var(--accent)}
    .meta{display:flex;flex-direction:column}
    .meta .title{font-weight:700}
    .meta .excerpt{color:var(--muted);font-size:13px;margin-top:6px}
    .right{margin-left:auto;text-align:right}
    .badge{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-size:13px}
    /* Thread view */
    #thread-area{margin-top:14px;display:none}
    .post{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    textarea,input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    footer{color:var(--muted);text-align:center;margin-top:12px;font-size:13px}
    @media (max-width:900px){ .layout{grid-template-columns:1fr} aside{order:2} main{order:1} nav{display:none} .avatar{width:44px;height:44px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <div class="mark">BSC</div>
        <div>
          <h1>BlackStreamCL Forum</h1>
          <p>Foro informativo — réplica demo</p>
        </div>
      </div>
      <nav>
        <button class="btn primary" id="btn-new">Crear Hilo</button>
        <button class="btn" id="btn-reset">Restaurar</button>
      </nav>
    </header>

    <div class="layout">
      <!-- SIDEBAR -->
      <aside class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Categorías</strong>
          <span class="badge" id="total-threads">0</span>
        </div>

        <div class="search" style="margin-top:12px">
          <input id="search" placeholder="Buscar hilos..." />
        </div>

        <div class="cat-list" id="categories">
          <!-- populated -->
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0" />

        <div style="display:flex;gap:8px">
          <select id="filter-cat" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit">
            <option value="">Todas</option>
          </select>
          <select id="sort-by" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:inherit">
            <option value="recent">Recientes</option>
            <option value="replies">Más respuestas</option>
          </select>
        </div>
      </aside>

      <!-- MAIN -->
      <main>
        <div class="card">
          <div class="controls">
            <h3 id="main-title">Hilos</h3>
            <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
              <span class="badge" id="selected-cat" style="display:none"></span>
              <div style="color:var(--muted);font-size:13px" id="results-info"></div>
            </div>
          </div>

          <div class="threads" id="threads-list"></div>

          <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
            <button class="btn" id="prev-page">‹</button>
            <div style="align-self:center;color:var(--muted)" id="page-info">1/1</div>
            <button class="btn" id="next-page">›</button>
          </div>
        </div>

        <div id="thread-area" class="card">
          <!-- thread content injected here -->
        </div>

        <footer>Réplica demo — No es la web real; para producción usar assets / API reales.</footer>
      </main>
    </div>
  </div>

  <script>
    // Simple demo state (dark-style forum). Guarda en localStorage.
    const DEMO = {
      categories: [
        {id:'gen',name:'General'},
        {id:'tech',name:'Tecnología'},
        {id:'ann',name:'Anuncios'},
        {id:'help',name:'Ayuda'}
      ],
      threads: [
        {id:'t1',title:'Bienvenidos a BlackStreamCL',category:'ann',author:'Admin',createdAt:'2025-11-01T10:00:00Z',content:'Hilo oficial de bienvenida. Lee las reglas.',replies:[{id:'r1',author:'User1',createdAt:'2025-11-02T12:00:00Z',content:'Gracias!'}]},
        {id:'t2',title:'¿Qué GPU recomiendan?',category:'tech',author:'Pedrox',createdAt:'2025-11-10T09:30:00Z',content:'Estoy armando un pc para streaming y gaming.',replies:[]},
        {id:'t3',title:'Reglas del foro',category:'ann',author:'Mod',createdAt:'2025-10-20T08:00:00Z',content:'Lee antes de postear.',replies:[]}
      ]
    };

    const STORAGE_KEY = 'bscl_demo_v1';
    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DEMO)); return structuredClone(DEMO); }
      try{ return JSON.parse(raw); }catch(e){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DEMO)); return structuredClone(DEMO); }
    }
    function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }

    let state = loadState();
    let page = 1, pageSize = 6;
    let selectedCategory = '', searchQ = '', sortBy = 'recent';

    // DOM
    const categoriesEl = document.getElementById('categories');
    const threadsList = document.getElementById('threads-list');
    const totalThreads = document.getElementById('total-threads');
    const searchInput = document.getElementById('search');
    const filterCat = document.getElementById('filter-cat');
    const sortSelect = document.getElementById('sort-by');
    const selectedBadge = document.getElementById('selected-cat');
    const resultsInfo = document.getElementById('results-info');
    const mainTitle = document.getElementById('main-title');
    const threadArea = document.getElementById('thread-area');
    const pageInfo = document.getElementById('page-info');
    const prevBtn = document.getElementById('prev-page');
    const nextBtn = document.getElementById('next-page');
    const btnNew = document.getElementById('btn-new');
    const btnReset = document.getElementById('btn-reset');

    // Render helpers
    function getCategoryName(id){ const c = state.categories.find(x=>x.id===id); return c?c.name:'Sin categoría' }

    function renderCategories(){
      categoriesEl.innerHTML = '';
      filterCat.innerHTML = '<option value="">Todas</option>';
      state.categories.forEach(cat=>{
        const div = document.createElement('div'); div.className='cat';
        div.innerHTML = `<div style="font-weight:700">${cat.name}</div><div style="margin-left:auto;color:var(--muted)">${state.threads.filter(t=>t.category===cat.id).length}</div>`;
        div.onclick = ()=>{ selectedCategory = cat.id; page = 1; render(); };
        categoriesEl.appendChild(div);

        const opt = document.createElement('option'); opt.value = cat.id; opt.textContent = cat.name; filterCat.appendChild(opt);
      });
    }

    function renderThreads(){
      let list = state.threads.slice();
      if(selectedCategory) list = list.filter(t=>t.category===selectedCategory);
      if(searchQ) {
        const q = searchQ.toLowerCase();
        list = list.filter(t => (t.title+t.content+(t.author||'')).toLowerCase().includes(q));
      }
      if(sortBy==='recent') list.sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));
      else list.sort((a,b)=> (b.replies?.length||0)-(a.replies?.length||0));

      const total = list.length;
      const pages = Math.max(1, Math.ceil(total/pageSize));
      if(page>pages) page = pages;
      const start = (page-1)*pageSize;
      const items = list.slice(start, start+pageSize);

      threadsList.innerHTML = '';
      if(items.length===0) threadsList.innerHTML = `<div style="color:var(--muted);padding:12px;border-radius:8px">No hay hilos.</div>`;
      else items.forEach(t=>{
        const div = document.createElement('div'); div.className='thread';
        const initials = (t.author||'U').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase();
        div.innerHTML = `
          <div class="avatar">${initials}</div>
          <div class="meta">
            <div class="title">${escapeHtml(t.title)}</div>
            <div class="excerpt">${escapeHtml(t.content.slice(0,140))}${t.content.length>140?'…':''}</div>
            <div style="color:var(--muted);font-size:12px;margin-top:8px">${getCategoryName(t.category)} • ${timeAgo(new Date(t.createdAt))} • por ${escapeHtml(t.author||'Anónimo')}</div>
          </div>
          <div class="right">
            <div style="font-weight:700">${t.replies?.length||0}</div>
            <div style="color:var(--muted);font-size:12px">respuestas</div>
          </div>
        `;
        div.onclick = ()=> openThread(t.id);
        threadsList.appendChild(div);
      });

      totalThreads.textContent = total;
      resultsInfo.textContent = `${total} resultados`;
      selectedBadge.style.display = selectedCategory ? 'inline-block' : 'none';
      if(selectedCategory) selectedBadge.textContent = getCategoryName(selectedCategory);

      pageInfo.textContent = `${page} / ${pages}`;
    }

    // Thread view
    function openThread(id){
      const t = state.threads.find(x=>x.id===id);
      if(!t) return alert('Hilo no encontrado');
      threadArea.style.display = 'block';
      threadArea.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center">
          <div class="avatar" style="width:64px;height:64px;border-radius:12px">${(t.author||'U').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase()}</div>
          <div>
            <div style="font-size:20px;font-weight:800">${escapeHtml(t.title)}</div>
            <div style="color:var(--muted);font-size:13px">${getCategoryName(t.category)} • ${timeAgo(new Date(t.createdAt))} • por ${escapeHtml(t.author||'Anónimo')}</div>
          </div>
        </div>
        <div class="post" style="margin-top:12px;white-space:pre-wrap">${escapeHtml(t.content)}</div>
        <div style="margin-top:12px"><h4>${(t.replies?.length||0)} respuestas</h4></div>
      `;

      const replies = document.createElement('div'); replies.style.display='flex'; replies.style.flexDirection='column'; replies.style.gap='10px';
      (t.replies||[]).forEach(r=>{
        const rdiv = document.createElement('div'); rdiv.className='post';
        rdiv.innerHTML = `<div style="font-weight:700">${escapeHtml(r.author||'Anónimo')} <span style="font-weight:400;color:var(--muted);font-size:12px">• ${timeAgo(new Date(r.createdAt))}</span></div><div style="margin-top:8px;white-space:pre-wrap">${escapeHtml(r.content)}</div>`;
        replies.appendChild(rdiv);
      });
      threadArea.appendChild(replies);

      const replyForm = document.createElement('div'); replyForm.style.marginTop='12px';
      replyForm.innerHTML = `
        <h4>Responder</h4>
        <form id="reply-form">
          <div style="margin-bottom:8px"><input id="reply-author" placeholder="Tu nombre (opcional)"></div>
          <div style="margin-bottom:8px"><textarea id="reply-content" rows="4" required></textarea></div>
          <div style="display:flex;gap:8px"><button class="btn primary" type="submit">Publicar</button><button class="btn" id="close-thread" type="button">Cerrar</button></div>
        </form>
      `;
      threadArea.appendChild(replyForm);

      document.getElementById('reply-form').onsubmit = function(e){
        e.preventDefault();
        const author = document.getElementById('reply-author').value.trim() || 'Anónimo';
        const content = document.getElementById('reply-content').value.trim();
        if(!content) return alert('Escribe algo.');
        const reply = { id: cryptoRandomId(), author, content, createdAt: new Date().toISOString() };
        t.replies = t.replies || [];
        t.replies.push(reply);
        saveState(state);
        openThread(id);
        renderThreads();
      };
      document.getElementById('close-thread').onclick = ()=>{ threadArea.style.display='none'; };
      threadArea.scrollIntoView({behavior:'smooth'});
    }

    // Create thread (modal-like behaviour)
    btnNew.onclick = ()=>{
      // build quick create area inline
      threadArea.style.display = 'block';
      threadArea.innerHTML = `
        <h3>Crear nuevo hilo</h3>
        <form id="create-form">
          <div style="margin-bottom:8px"><input id="new-title" placeholder="Título del hilo" required></div>
          <div style="margin-bottom:8px">
            <select id="new-cat">${state.categories.map(c=>`<option value="${c.id}">${c.name}</option>`).join('')}</select>
          </div>
          <div style="margin-bottom:8px"><textarea id="new-content" rows="6" required></textarea></div>
          <div style="display:flex;gap:8px"><input id="new-author" placeholder="Tu nombre (opcional)"><input id="new-email" placeholder="Email (opcional)"></div>
          <div style="margin-top:10px;display:flex;gap:8px"><button class="btn primary" type="submit">Publicar</button><button class="btn" id="cancel-create" type="button">Cancelar</button></div>
        </form>
      `;
      document.getElementById('cancel-create').onclick = ()=>{ threadArea.style.display='none'; };
      document.getElementById('create-form').onsubmit = function(e){
        e.preventDefault();
        const title = document.getElementById('new-title').value.trim();
        const category = document.getElementById('new-cat').value;
        const content = document.getElementById('new-content').value.trim();
        const author = document.getElementById('new-author').value.trim() || 'Anónimo';
        if(!title||!content) return alert('Completa título y contenido.');
        const t = { id: cryptoRandomId(), title, category, content, author, createdAt: new Date().toISOString(), replies: [] };
        state.threads.unshift(t);
        saveState(state);
        render();
        openThread(t.id);
      };
      threadArea.scrollIntoView({behavior:'smooth'});
    };

    btnReset.onclick = ()=>{
      if(!confirm('Restaurar datos de demo eliminará tus cambios locales. ¿Continuar?')) return;
      localStorage.removeItem(STORAGE_KEY);
      state = loadState();
      render();
      alert('Demo restaurado.');
    };

    // Search / filters
    searchInput.oninput = (e)=>{ searchQ = e.target.value.trim(); page = 1; render(); };
    filterCat.onchange = (e)=>{ selectedCategory = e.target.value; page = 1; render(); };
    sortSelect.onchange = (e)=>{ sortBy = e.target.value; render(); };
    prevBtn.onclick = ()=>{ if(page>1){ page--; render(); } };
    nextBtn.onclick = ()=>{ page++; render(); };

    // Utilities
    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function timeAgo(d){
      const diff = (Date.now() - d.getTime())/1000;
      if(diff < 60) return `${Math.floor(diff)}s`;
      if(diff < 3600) return `${Math.floor(diff/60)}m`;
      if(diff < 86400) return `${Math.floor(diff/3600)}h`;
      const days = Math.floor(diff/86400);
      if(days < 30) return `${days}d`;
      return d.toLocaleDateString();
    }
    function cryptoRandomId(){ return Math.random().toString(36).slice(2,9); }

    // Initial render
    function render(){ renderCategories(); renderThreads(); }
    render();

    // Expose state for debugging
    window._forumState = state;
  </script>
</body>
</html>

